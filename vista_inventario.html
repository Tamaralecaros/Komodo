<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KÓMODO — Inventario</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/inventario.css">
  <script type="module">
    import { guard } from "./js/roles.js";
    guard(["admin","trabajador"], "index.html");
  </script>
</head>
<body>
  <header class="header">
  <div class="wrap header__inner">
    <a class="brand" href="index.html" aria-label="Inicio KÓMODO">
      <img src="img/k_logo.png" alt="KÓMODO" class="brand__logo" />
    </a>
    </div>
    <nav class="tabs">
      <div class="wrap tabs__row" role="tablist" aria-label="Panel">
        <a class="tab" href="vista_ingresos.html">Ingresos</a>
        <a class="tab" href="vista_reservas.html">Reservas</a>
        <a class="tab is-active" href="vista_inventario.html" aria-selected="true">Inventario</a>
        <a class="tab" href="vista_solicitudes.html">Solicitudes</a>
      </div>
    </nav>
  </header>

  <!-- Inventario: buscador + CRUD + solicitudes -->
  <main>
    <section class="inv">
      <header class="inv__header wrap">
        <h1>Inventario</h1>
        <div class="inv__controls">
          <input id="invSearch" type="search" placeholder="Buscar producto… (ej: tinte, tijera)">
          <select id="invFilterCat" title="Categoría">
            <option value="">Todas las categorías</option>
            <option>Coloración</option><option>Corte</option><option>Tratamientos</option><option>Accesorios</option><option>Higiene</option>
          </select>
          <button id="btnAddProduct" class="btn btn--gold">Agregar producto</button>
          <button id="btnViewRequests" class="btn btn--ghost">Solicitudes</button>
        </div>
      </header>

      <div class="wrap">
        <table class="inv__table" id="invTable" aria-label="Tabla de inventario">
          <thead>
            <tr>
              <th>Producto</th><th>Categoría</th><th>Stock</th><th>Mín.</th><th>Unidad</th><th>Estado</th><th>Actualizado</th><th style="min-width:220px">Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <p class="inv__hint">Consejo: los ítems en <strong>bajo stock</strong> aparecen resaltados para reponerlos rápido.</p>
      </div>
    </section>

    <!-- Modales -->
    <dialog id="modalProduct" class="modal">
      <form method="dialog" class="modal__card" id="productForm">
        <h3 id="modalProductTitle">Nuevo producto</h3>
        <div class="grid">
          <label>Nombre <input name="name" required></label>
          <label>Categoría
            <select name="category" required>
              <option value="">Seleccionar…</option>
              <option>Coloración</option><option>Corte</option><option>Tratamientos</option><option>Accesorios</option><option>Higiene</option>
            </select>
          </label>
          <label>Stock <input name="stock" type="number" min="0" step="1" required></label>
          <label>Stock mínimo <input name="min" type="number" min="0" step="1" required></label>
          <label>Unidad <input name="unit" placeholder="u, ml, gr…"></label>
        </div>
        <menu class="modal__actions">
          <button value="cancel" class="btn btn--ghost">Cancelar</button>
          <button id="btnSaveProduct" class="btn btn--gold" value="default">Guardar</button>
        </menu>
        <input type="hidden" name="id">
      </form>
    </dialog>

    <dialog id="modalRequest" class="modal">
      <form method="dialog" class="modal__card" id="requestForm">
        <h3>Solicitud de compra</h3>
        <p id="reqProductLabel" class="muted"></p>
        <div class="grid">
          <label>Cantidad a solicitar <input name="qty" type="number" min="1" step="1" required></label>
          <label>Comentario (opcional) <input name="note" placeholder="Proveedor sugerido, color, formato…"></label>
        </div>
        <menu class="modal__actions">
          <button value="cancel" class="btn btn--ghost">Cancelar</button>
          <button class="btn btn--gold" value="default">Enviar solicitud</button>
        </menu>
        <input type="hidden" name="id">
      </form>
    </dialog>

    <dialog id="modalRequestsList" class="modal">
      <div class="modal__card">
        <h3>Solicitudes de compra</h3>
        <div id="requestsContainer" class="requests"></div>
        <menu class="modal__actions">
          <button class="btn btn--gold" onclick="document.getElementById('modalRequestsList').close()">Cerrar</button>
        </menu>
      </div>
    </dialog>
  </main>

  <footer class="footer"><div class="wrap"><small>© <span id="year"></span> KÓMODO — Proyecto académico</small></div></footer>
  <script src="js/inventario.js"></script>
</body>
</html>
