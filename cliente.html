<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KÓMODO — Cotizar</title>
  <link rel="stylesheet" href="css/styles.css"/>
</head>
<body>
  <!-- Header igual al home, versión mínima para flujo de cotización -->
  <header class="header">
    <div class="wrap header__inner">
      <a class="brand" href="index.html" aria-label="Inicio KÓMODO">
        <img src="img/k_logo.png" alt="KÓMODO" class="brand__logo" />
      </a>

      <nav class="header__nav">
        <a class="nav__link" href="vista_servicios.html">Servicios</a>
        <!-- Eliminado "Iniciar sesión" porque ya usas el botón Ingresar/Registro en la página -->
        <!-- <a class="nav__link" href="#" id="openLogin">Iniciar sesión</a> -->
      </nav>
    </div>
  </header>

  <main>
    <section class="quote wrap">
      <header class="quote__head">
        <h1>Cotiza tu servicio</h1>
        <p>3 pasos rápidos. Mostramos un valor estimado y luego puedes confirmar tu reserva.</p>
      </header>

      <!-- Paso 0: indicador simple -->
      <ol class="steps" aria-label="Progreso">
        <li class="is-active"><span>1</span> Servicio</li>
        <li><span>2</span> Fecha y hora</li>
        <li><span>3</span> Tus datos</li>
      </ol>

      <!-- Paso 1: elección del servicio -->
      <form class="panel is-active" id="step1" autocomplete="off">
        <h2>¿Qué necesitas?</h2>

        <!-- Categorías (radio pills) -->
        <div class="pill-group" role="radiogroup" aria-label="Categoría">
          <label class="pill"><input type="radio" name="cat" value="cortes" checked /><span>Cortes</span></label>
          <label class="pill"><input type="radio" name="cat" value="alisados" /><span>Alisados</span></label>
          <label class="pill"><input type="radio" name="cat" value="color" /><span>Coloración</span></label>
          <label class="pill"><input type="radio" name="cat" value="tratamientos" /><span>Tratamientos</span></label>
        </div>

        <!-- Servicio específico -->
        <label class="field">
          <span>Servicio específico</span>
          <select id="svcSelect" required></select>
        </label>

        <!-- Opcional para cortes: lavado -->
        <label class="field" id="lavadoRow">
          <span>Lavado (opcional para cortes)</span>
          <label style="display:inline-flex;align-items:center;gap:8px;">
            <input type="checkbox" id="lavado" />
            <small id="lavadoInfo">Hombres/niños +$1.000 · Damas/niñas +$2.000</small>
          </label>
        </label>

        <!-- Factores extra (se ocultan en cortes) -->
        <div id="advancedFactors">
          <div class="grid2" style="grid-template-columns:repeat(3,1fr)">
            <label class="field">
              <span>Largo del cabello</span>
              <select id="largo" required>
                <option value="corto">Corto</option>
                <option value="medio">Medio</option>
                <option value="largo">Largo</option>
                <option value="extra">Extra-largo</option>
              </select>
            </label>
            <label class="field">
              <span>Abundancia</span>
              <select id="abundancia" required>
                <option value="poco">Poco</option>
                <option value="normal" selected>Normal</option>
                <option value="mucho">Mucho</option>
              </select>
            </label>
            <label class="field">
              <span>Tratamientos previos</span>
              <select id="historial" required>
                <option value="ninguno" selected>Ninguno</option>
                <option value="coloracion">Coloración / decoloración</option>
                <option value="alisado">Alisado / keratina</option>
                <option value="otros">Otros</option>
              </select>
            </label>
          </div>
        </div>

        <!-- Total vivo (lo actualiza cliente.js) -->
        <div class="price-live" aria-live="polite">
          Total estimado: <strong id="live_total">$0</strong>
        </div>

        <div class="actions">
          <button type="button" class="btn btn--gold btn--lg" id="toStep2">Siguiente</button>
        </div>
      </form>

      <!-- Paso 2: fecha y hora -->
      <form class="panel" id="step2" autocomplete="off">
        <h2>¿Cuándo te acomoda?</h2>

        <!-- Calendario + horas -->
        <div id="niceCal" class="cal-wrap">
          <div class="cal">
            <div class="cal__header">
              <button type="button" class="cal__nav" id="calPrev" aria-label="Mes anterior">‹</button>
              <div class="cal__title"><span id="calMonth">Mes</span> <span id="calYear">Año</span></div>
              <button type="button" class="cal__nav" id="calNext" aria-label="Mes siguiente">›</button>
            </div>
            <div class="cal__week cal__row">
              <span>LUN</span><span>MAR</span><span>MIÉ</span><span>JUE</span><span>VIE</span><span>SÁB</span><span>DOM</span>
            </div>
            <div class="cal__grid" id="calGrid" aria-live="polite"></div>
          </div>
          <div class="times">
            <div class="times__title" id="timesTitle">Selecciona un día</div>
            <div id="timesList" class="times__list"></div>
          </div>
        </div>

        <!-- Campos que usa el flujo -->
        <input type="hidden" id="fecha" />
        <input type="hidden" id="hora" />

        <div class="price-live" aria-live="polite">
          Total estimado: <strong id="live_total_s2">$0</strong>
        </div>

        <div class="actions">
          <button type="button" class="btn btn--ghost" id="back1">Volver</button>
          <button type="button" class="btn btn--gold btn--lg" id="toStep3">Siguiente</button>
        </div>
      </form>

      <!-- Paso 3: datos finales -->
      <form class="panel" id="step3" autocomplete="off">
        <h2>Confirma tus datos</h2>

        <div class="grid2">
          <label class="field"><span>Nombre</span><input type="text" id="nombre" placeholder="Tu nombre" required /></label>
          <label class="field"><span>Correo</span><input type="email" id="correo" placeholder="tu@correo.cl" required /></label>
        </div>

        <!-- Resumen (cliente.js lo actualiza) -->
        <aside class="resume" aria-live="polite">
          <h3>Resumen</h3>
          <ul>
            <li><strong>Servicio:</strong> <span id="r_servicio">—</span></li>
            <li id="r_largo_li"><strong>Largo:</strong> <span id="r_largo">—</span></li>
            <li id="r_abun_li"><strong>Abundancia:</strong> <span id="r_abun">—</span></li>
            <li id="r_hist_li"><strong>Historial:</strong> <span id="r_hist">—</span></li>
            <li id="r_lavado_li" style="display:none;"><strong>Lavado:</strong> <span id="r_lavado">No</span></li>
            <li><strong>Fecha:</strong> <span id="r_fecha">—</span></li>
            <li><strong>Hora:</strong> <span id="r_hora">—</span></li>
            <li><strong>Total estimado:</strong> <span id="r_total">$0</span></li>
          </ul>
          <p class="hint">Valores referenciales; algunos casos requieren evaluación previa.</p>
        </aside>

        <div class="actions">
          <button type="button" class="btn btn--ghost" id="back2">Volver</button>
          <button type="submit" class="btn btn--gold btn--lg" id="btn-confirmar-reserva">Confirmar</button>
        </div>
      </form>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="wrap"><small>© <span id="year"></span> KÓMODO — Proyecto académico</small></div>
  </footer>

  <!-- Modal login simple (mock) - lo dejamos por si lo usas más adelante (ya no hay link en el header) -->
  <dialog id="authModal" class="auth">
    <form method="dialog" class="auth__panel" aria-labelledby="authTitle">
      <h2 id="authTitle" class="auth__title">Bienvenido</h2>
      <label class="field"><span>Correo</span><input type="email" placeholder="tu@correo.cl"/></label>
      <label class="field"><span>Contraseña</span><input type="password" placeholder="••••••••"/></label>
      <div class="auth__actions">
        <button class="btn btn--gold" value="login">Iniciar sesión</button>
        <a class="auth__alt" href="registro.html">Crear cuenta</a>
        <button class="btn btn--ghost" value="close">Cerrar</button>
      </div>
    </form>
  </dialog>

  <!-- JS global del sitio -->
  <script src="js/main.js"></script>

  <!-- EmailJS SDK + init (usar SIEMPRE antes de cliente.js) -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <script>
    // ✅ Tu Public Key real de EmailJS
    emailjs.init("wJn2iMQKwXdMDtvqH");
  </script>

  <!-- Lógica específica del cotizador (con EmailJS integrado) -->
  <script src="js/cliente.js"></script>

  <!-- (Opcional) Script de apertura modal: ya no hay #openLogin así que no hace nada -->
  <script>
    document.getElementById("openLogin")?.addEventListener("click", (e)=>{
      e.preventDefault(); document.getElementById("authModal").showModal();
    });
  </script>
</body>
</html>
